/**
 * Product controller using caching
 */

const productRepo = require("../repositories/product.repository");
const cacheService = require("../services/cache.service");

const getCachedProducts = async (req, res) => {
    try {
        const cacheKey = "PRODUCT_LIST";

        const cachedData = cacheService.get(cacheKey);
        if (cachedData) {
            return res.json({
                source: "CACHE",
                data: cachedData
            });
        }

        const result = await productRepo.findAll({}, {
            skip: 0,
            limit: 20,
            sort: { createdAt: -1 }
        });

        cacheService.set(cacheKey, result.products);

        res.json({
            source: "DATABASE",
            data: result.products
        });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
};

module.exports = { getCachedProducts };
